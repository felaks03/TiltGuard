<div class="content" (click)="cerrarMenu()">
    <div class="header-container">
        <h1>Usuarios</h1>
        <button class="btn-crear" (click)="abrirSidebar()">+ Crear Usuario</button>
    </div>

    @if (error()) {
    <div class="error">
        <p>{{ error() }}</p>
    </div>
    }

    @if (!error() && usuarios().length > 0) {
    <div class="usuarios-header">
        <span class="usuarios-counter">Total: {{ usuarios().length }} usuarios</span>
    </div>
    <div class="usuarios-lista">
        @for (usuario of usuarios(); track usuario._id) {
        <div class="usuario-item">
            <img class="usuario-avatar" [src]="usuario.avatar || '/assets/defaultAvatar.jpg'" [alt]="usuario.nombre" />
            <div class="usuario-info">
                <div class="usuario-nombre">{{ usuario.nombre }}</div>
                <div class="usuario-email">{{ usuario.email }}</div>
                <span class="usuario-rol" [class.admin]="usuario.rol === 'admin'"
                    [class.usuario]="usuario.rol === 'usuario'">
                    {{ usuario.rol }}
                </span>
                <span class="usuario-estado" [class.activo]="usuario.activo" [class.inactivo]="!usuario.activo">
                    {{ usuario.activo ? "Activo" : "Inactivo" }}
                </span>
                <div class="usuario-menu-container">
                    <button class="menu-btn" (click)="toggleMenu(usuario._id, $event)" title="Opciones">
                        <span class="menu-dots">‚ãÆ</span>
                    </button>
                    @if (menuAbiertoId() === usuario._id) {
                    <div class="menu-dropdown" (click)="$event.stopPropagation()">
                        <button class="menu-item" (click)="verDetalles(usuario)">
                            <span class="icon">üëÅÔ∏è</span> Detalles
                        </button>
                        <button class="menu-item" (click)="editar(usuario)">
                            <span class="icon">‚úèÔ∏è</span> Editar
                        </button>
                        <button class="menu-item delete" (click)="eliminar(usuario)">
                            <span class="icon">üóëÔ∏è</span> Eliminar
                        </button>
                    </div>
                    }
                </div>
            </div>
        </div>
        }
    </div>
    }

    @if (!error() && usuarios().length === 0) {
    <div class="no-usuarios">
        <p>No hay usuarios registrados</p>
    </div>
    }
</div>

@if (sidebarAbierta()) {
<div class="sidebar-overlay" (click)="cerrarSidebar()"></div>
<div class="sidebar">
    <div class="sidebar-header">
        <h2>Crear Nuevo Usuario</h2>
        <button class="btn-cerrar" (click)="cerrarSidebar()">‚úï</button>
    </div>

    <form (ngSubmit)="crearUsuario()" class="create-form">
        <div class="form-group">
            <label for="nombre">Nombre *</label>
            <input type="text" id="nombre" [(ngModel)]="nuevoUsuario().nombre" name="nombre"
                placeholder="Nombre del usuario" required />
        </div>

        <div class="form-group">
            <label for="email">Email *</label>
            <input type="email" id="email" [(ngModel)]="nuevoUsuario().email" name="email"
                placeholder="correo@example.com" required />
        </div>

        <div class="form-group">
            <label for="password">Contrase√±a *</label>
            <input type="password" id="password" [(ngModel)]="nuevoUsuario().password" name="password"
                placeholder="Contrase√±a segura" required />
        </div>

        <div class="form-group">
            <label for="rol">Rol</label>
            <select id="rol" [(ngModel)]="nuevoUsuario().rol" name="rol">
                <option value="usuario">Usuario</option>
                <option value="admin">Admin</option>
            </select>
        </div>

        <div class="form-group">
            <label for="telefono">Tel√©fono</label>
            <input type="text" id="telefono" [(ngModel)]="nuevoUsuario().telefono" name="telefono"
                placeholder="+34 600 000 000" />
        </div>

        <div class="form-group">
            <label for="ciudad">Ciudad</label>
            <input type="text" id="ciudad" [(ngModel)]="nuevoUsuario().ciudad" name="ciudad" placeholder="Madrid" />
        </div>

        <div class="form-group">
            <label for="pais">Pa√≠s</label>
            <input type="text" id="pais" [(ngModel)]="nuevoUsuario().pais" name="pais" placeholder="Espa√±a" />
        </div>

        <div class="form-group checkbox">
            <label for="activo">
                <input type="checkbox" id="activo" [(ngModel)]="nuevoUsuario().activo" name="activo" />
                Usuario Activo
            </label>
        </div>

        <div class="sidebar-actions">
            <button type="submit" class="btn btn-primary" [disabled]="creandoUsuario()">
                {{ creandoUsuario() ? "Creando..." : "Crear Usuario" }}
            </button>
            <button type="button" class="btn btn-secondary" (click)="cerrarSidebar()" [disabled]="creandoUsuario()">
                Cancelar
            </button>
        </div>
    </form>
</div>
}