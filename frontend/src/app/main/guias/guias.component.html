<div class="guias-page">

    <!-- Access Block Overlay -->
    @if (showOverlay()) {
    <div class="access-overlay">
        <div class="access-overlay-content">
            @if (overlayMode() === 'request') {
            <h2>üîê Acceso Restringido</h2>
            <p>Ya has completado la configuraci√≥n. Si necesitas volver a revisar las gu√≠as, solicita acceso.</p>
            <button class="request-btn" (click)="requestAccess()" [disabled]="isLoading()">
                @if (isLoading()) {
                Solicitando...
                } @else {
                üìã Solicitar acceso
                }
            </button>
            } @else if (overlayMode() === 'cooldown') {
            <h2>‚è≥ Procesando solicitud...</h2>
            <p>Por favor espera para acceder a las gu√≠as:</p>
            <div class="cooldown-timer-box">
                <strong>{{ cooldownText() }}</strong>
            </div>
            <p class="cooldown-hint">El acceso se desbloquear√° autom√°ticamente al terminar</p>
            }
        </div>
    </div>
    }

    <!-- Access Timer (top-right badge) -->
    @if (hasActiveAccess()) {
    <div class="access-timer-badge">
        <span class="timer-label">‚è±Ô∏è Acceso:</span>
        <span class="timer-value">{{ accessText() }}</span>
    </div>
    }

    <!-- Main Content (blurs when overlay is active) -->
    <div class="guias-main-content" [class.blurred]="showOverlay()">

        <div class="guias-header">
            <h1>üîí Protecci√≥n Avanzada TiltGuard</h1>
            <p class="subtitle">Un solo comando para: extensi√≥n inremovible + inc√≥gnito desactivado + Tradovate
                eliminado</p>
        </div>

        <!-- Error -->
        @if (errorMessage()) {
        <div class="alert alert-error">
            <span>‚ö†Ô∏è {{ errorMessage() }}</span>
            <button class="retry-btn" (click)="retryLoad()">üîÑ Reintentar</button>
        </div>
        }

        <!-- Loading -->
        @if (isLoading() && !showOverlay()) {
        <div class="loading-state">
            <div class="spinner"></div>
            <p>Cargando...</p>
        </div>
        }

        <div class="guias-content">
            <!-- Controls -->
            <div class="controls-card">
                <div class="main-selector">
                    <p class="selector-label">¬øQu√© deseas hacer?</p>
                    <div class="main-buttons">
                        <button class="main-btn" [class.active]="mainType() === 'install'"
                            (click)="setMainType('install')">
                            üì• Activar protecci√≥n
                        </button>
                        <button class="main-btn" [class.active]="mainType() === 'uninstall'"
                            [disabled]="!canUninstall()" (click)="setMainType('uninstall')">
                            üóëÔ∏è Desactivar protecci√≥n
                        </button>
                    </div>
                </div>

                <div class="browser-detector">
                    <p>Navegador: <strong>Google Chrome</strong></p>
                </div>

                <div class="os-selector">
                    <p class="selector-label">Selecciona tu sistema operativo:</p>
                    <div class="os-buttons">
                        <button class="os-btn" [class.active]="(selectedOSId() || detectedOSId()) === 'windows'"
                            (click)="selectOS('windows')">
                            ü™ü Windows
                        </button>
                        <button class="os-btn" [class.active]="(selectedOSId() || detectedOSId()) === 'mac'"
                            (click)="selectOS('mac')">
                            üçé macOS
                        </button>
                        <button class="os-btn" [class.active]="(selectedOSId() || detectedOSId()) === 'linux'"
                            (click)="selectOS('linux')">
                            üêß Linux
                        </button>
                    </div>
                    <p class="os-detected-hint">SO detectado: <strong>{{ detectedOS() }}</strong> (puedes cambiarlo)</p>
                </div>

                @if (extensionId()) {
                <div class="extension-id-badge">
                    <span>üîë ID de extensi√≥n detectado: <strong>{{ extensionId() }}</strong></span>
                </div>
                } @else {
                <div class="extension-id-warning">
                    <span>‚ö†Ô∏è No se ha detectado el ID de la extensi√≥n. Aseg√∫rate de tener la extensi√≥n TiltGuard
                        instalada e iniciada sesi√≥n en ella.</span>
                </div>
                }
            </div>

            <!-- WINDOWS -->
            @if (guideConfigs().guideId === 'windows-install' || guideConfigs().guideId === 'windows-uninstall') {
            <div class="guide-section">
                @if (mainType() === 'install') {
                <h2>ü™ü Windows - Activar protecci√≥n completa</h2>
                <div class="warning-box">
                    <p>‚ö†Ô∏è <strong>Importante:</strong> Necesitas abrir PowerShell como Administrador.</p>
                    <div class="admin-steps">
                        <p><strong>C√≥mo abrir PowerShell como Administrador:</strong></p>
                        <ol>
                            <li>Pulsa la tecla <strong>Windows</strong> en tu teclado</li>
                            <li>Escribe <strong>PowerShell</strong></li>
                            <li>Haz clic derecho en <strong>"Windows PowerShell"</strong></li>
                            <li>Selecciona <strong>"Ejecutar como administrador"</strong></li>
                            <li>Haz clic en <strong>"S√≠"</strong> en el aviso que aparece</li>
                        </ol>
                    </div>
                </div>
                <div class="what-it-does">
                    <h3>Este comando hace las 3 cosas a la vez:</h3>
                    <ul>
                        <li>üîí Fuerza la extensi√≥n TiltGuard (no se puede desinstalar)</li>
                        <li>üö´ Desactiva el modo inc√≥gnito en Chrome</li>
                        <li>üóëÔ∏è Elimina Tradovate de escritorio, instaladores y datos</li>
                    </ul>
                </div>
                <div class="guide-instructions">
                    @if (extensionId()) {
                    <p>Copia y pega todo el siguiente bloque en PowerShell (Administrador):</p>
                    } @else {
                    <p>‚ö†Ô∏è El ID de la extensi√≥n no se ha detectado. Abre la extensi√≥n TiltGuard, inicia sesi√≥n y recarga
                        esta p√°gina. Mientras tanto, puedes reemplazar <code>TU_EXTENSION_ID</code> manualmente
                        copi√°ndolo de <code>chrome://extensions</code>.</p>
                    }
                    <div class="code-block" [innerText]="codeBlock()"></div>
                </div>
                } @else {
                <h2>ü™ü Windows - Desactivar protecci√≥n</h2>
                <div class="warning-box">
                    <p>‚ö†Ô∏è Abre <strong>PowerShell como Administrador</strong> (tecla Windows ‚Üí escribe "PowerShell" ‚Üí
                        clic derecho ‚Üí "Ejecutar como administrador").</p>
                </div>
                <div class="guide-instructions">
                    <p>Copia y pega en PowerShell (Administrador):</p>
                    <div class="code-block" [innerText]="codeBlock()"></div>
                </div>
                }
            </div>
            }

            <!-- MAC -->
            @if (guideConfigs().guideId === 'mac-install' || guideConfigs().guideId === 'mac-uninstall') {
            <div class="guide-section">
                @if (mainType() === 'install') {
                <h2>üçé macOS - Activar protecci√≥n completa</h2>
                <div class="warning-box">
                    <p>‚ö†Ô∏è <strong>Importante:</strong> Este comando usa <code>sudo</code>, te pedir√° tu contrase√±a de
                        Mac.</p>
                    <div class="admin-steps">
                        <p><strong>C√≥mo abrir Terminal:</strong></p>
                        <ol>
                            <li>Pulsa <strong>Cmd + Espacio</strong> (b√∫squeda Spotlight)</li>
                            <li>Escribe <strong>Terminal</strong> y pulsa <strong>Enter</strong></li>
                            <li>Pega el comando y pulsa <strong>Enter</strong></li>
                            <li>Cuando pida contrase√±a, escr√≠bela (no se ve al escribir) y pulsa <strong>Enter</strong>
                            </li>
                        </ol>
                    </div>
                </div>
                <div class="what-it-does">
                    <h3>Este comando hace las 3 cosas a la vez:</h3>
                    <ul>
                        <li>üîí Fuerza la extensi√≥n TiltGuard (no se puede desinstalar)</li>
                        <li>üö´ Desactiva el modo inc√≥gnito en Chrome</li>
                        <li>üóëÔ∏è Elimina Tradovate de escritorio, instaladores y datos</li>
                    </ul>
                </div>
                <div class="guide-instructions">
                    @if (extensionId()) {
                    <p>Copia y pega todo el siguiente bloque en Terminal:</p>
                    } @else {
                    <p>‚ö†Ô∏è El ID de la extensi√≥n no se ha detectado. Abre la extensi√≥n TiltGuard, inicia sesi√≥n y recarga
                        esta p√°gina. Mientras tanto, puedes reemplazar <code>TU_EXTENSION_ID</code> manualmente
                        copi√°ndolo de <code>chrome://extensions</code>.</p>
                    }
                    <div class="code-block" [innerText]="codeBlock()"></div>
                </div>
                } @else {
                <h2>üçé macOS - Desactivar protecci√≥n</h2>
                <div class="warning-box">
                    <p>‚ö†Ô∏è Este comando usa <code>sudo</code>, te pedir√° tu contrase√±a de Mac.</p>
                </div>
                <div class="guide-instructions">
                    <p>Abre Terminal (<strong>Cmd + Espacio</strong> ‚Üí escribe "Terminal") y pega:</p>
                    <div class="code-block" [innerText]="codeBlock()"></div>
                </div>
                }
            </div>
            }

            <!-- LINUX -->
            @if (guideConfigs().guideId === 'linux-install' || guideConfigs().guideId === 'linux-uninstall') {
            <div class="guide-section">
                @if (mainType() === 'install') {
                <h2>üêß Linux - Activar protecci√≥n completa</h2>
                <div class="warning-box">
                    <p>‚ö†Ô∏è <strong>Importante:</strong> Este comando usa <code>sudo</code>, te pedir√° tu contrase√±a de
                        usuario.</p>
                    <div class="admin-steps">
                        <p><strong>C√≥mo abrir Terminal:</strong></p>
                        <ol>
                            <li>Pulsa <strong>Ctrl + Alt + T</strong> (atajo en la mayor√≠a de distros)</li>
                            <li>O busca <strong>"Terminal"</strong> en el men√∫ de aplicaciones</li>
                            <li>Pega el comando y pulsa <strong>Enter</strong></li>
                            <li>Cuando pida contrase√±a, escr√≠bela (no se ve al escribir) y pulsa <strong>Enter</strong>
                            </li>
                        </ol>
                    </div>
                </div>
                <div class="what-it-does">
                    <h3>Este comando hace las 3 cosas a la vez:</h3>
                    <ul>
                        <li>üîí Fuerza la extensi√≥n TiltGuard (no se puede desinstalar)</li>
                        <li>üö´ Desactiva el modo inc√≥gnito en Chrome</li>
                        <li>üóëÔ∏è Elimina Tradovate de escritorio, instaladores y datos</li>
                    </ul>
                </div>
                <div class="guide-instructions">
                    @if (extensionId()) {
                    <p>Copia y pega todo el siguiente bloque en Terminal:</p>
                    } @else {
                    <p>‚ö†Ô∏è El ID de la extensi√≥n no se ha detectado. Abre la extensi√≥n TiltGuard, inicia sesi√≥n y recarga
                        esta p√°gina. Mientras tanto, puedes reemplazar <code>TU_EXTENSION_ID</code> manualmente
                        copi√°ndolo de <code>chrome://extensions</code>.</p>
                    }
                    <div class="code-block" [innerText]="codeBlock()"></div>
                </div>
                } @else {
                <h2>üêß Linux - Desactivar protecci√≥n</h2>
                <div class="warning-box">
                    <p>‚ö†Ô∏è Este comando usa <code>sudo</code>, te pedir√° tu contrase√±a de usuario.</p>
                </div>
                <div class="guide-instructions">
                    <p>Abre Terminal (<strong>Ctrl + Alt + T</strong>) y pega:</p>
                    <div class="code-block" [innerText]="codeBlock()"></div>
                </div>
                }
            </div>
            }

            <!-- Footer action -->
            <div class="footer-card">
                @if (mainType() === 'install') {
                <button class="done-btn" (click)="openConfirmModal('install')">
                    ‚úì Ya he ejecutado el comando
                </button>
                } @else {
                <button class="done-btn uninstall" (click)="openConfirmModal('uninstall')">
                    ‚úì Ya he ejecutado el comando
                </button>
                }
            </div>

            <!-- Sync info -->
            <div class="sync-info">
                <div class="sync-icon">üîó</div>
                <div class="sync-text">
                    <h4>Sincronizaci√≥n con la extensi√≥n</h4>
                    <p>
                        Los timers de acceso a gu√≠as se sincronizan autom√°ticamente
                        entre la web y la extensi√≥n del navegador.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
@if (showConfirmModal()) {
<div class="modal-overlay" (click)="cancelConfirmModal()">
    <div class="modal-box" (click)="$event.stopPropagation()">
        @if (confirmAction() === 'install') {
        <h2>¬øCompletar instalaci√≥n?</h2>
        <p>Confirma que has ejecutado el comando y completado la protecci√≥n.</p>
        <p class="modal-warning">
            Despu√©s de confirmar, necesitar√°s solicitar acceso (espera de 2 horas) para volver a ver las gu√≠as.
        </p>
        } @else {
        <h2>¬øDesactivar protecci√≥n?</h2>
        <p>Esto desactivar√° toda la protecci√≥n (extensi√≥n, inc√≥gnito y bloqueo de Tradovate). ¬øDeseas continuar?</p>
        }
        <div class="modal-actions">
            <button class="btn btn-cancel" (click)="cancelConfirmModal()">Cancelar</button>
            <button class="btn btn-confirm" (click)="confirmSetup()">Confirmar</button>
        </div>
    </div>
</div>
}